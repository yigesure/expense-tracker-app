# 🚀 版本发布流程

本文档描述了Flutter记账应用的完整版本发布流程，包括版本管理、构建、测试和发布的最佳实践。

## 📋 发布前准备

### 1. 版本规划

使用语义化版本控制 (Semantic Versioning)：

- **主版本号** (Major): 不兼容的API修改
- **次版本号** (Minor): 向下兼容的功能性新增
- **修订号** (Patch): 向下兼容的问题修正

示例：`1.2.3`

### 2. 更新版本号

#### 更新 pubspec.yaml

```yaml
version: 1.2.3+10  # 版本号+构建号
```

#### 更新 Android 版本

在 `android/app/build.gradle` 中：

```gradle
defaultConfig {
    versionCode 10        # 构建号（整数，递增）
    versionName "1.2.3"   # 版本名称
}
```

### 3. 更新变更日志

创建或更新 `CHANGELOG.md`：

```markdown
# 更新日志

## [1.2.3] - 2024-01-15

### 新增
- ✨ 添加语音记账功能
- ✨ 支持多币种显示

### 修复
- 🐛 修复统计图表显示错误
- 🐛 解决数据同步问题

### 改进
- 🎨 优化用户界面
- ⚡ 提升应用启动速度
```

## 🔄 发布流程

### 1. 开发阶段

```bash
# 创建功能分支
git checkout -b feature/voice-recording
git push -u origin feature/voice-recording

# 开发完成后合并到develop分支
git checkout develop
git merge feature/voice-recording
git push origin develop
```

### 2. 测试阶段

```bash
# 创建发布候选分支
git checkout -b release/v1.2.3
git push -u origin release/v1.2.3

# 在此分支进行最终测试和bug修复
```

#### 自动化测试

```bash
# 运行所有测试
flutter test

# 代码分析
flutter analyze

# 集成测试
flutter drive --target=test_driver/app.dart
```

### 3. 构建阶段

#### 本地构建测试

```bash
# 构建debug版本测试
flutter build apk --debug

# 构建release版本
flutter build apk --release --split-per-abi
```

#### GitHub Actions自动构建

推送到release分支会触发自动构建：

```bash
git push origin release/v1.2.3
```

### 4. 发布阶段

#### 合并到主分支

```bash
# 合并到main分支
git checkout main
git merge release/v1.2.3
git push origin main

# 创建版本标签
git tag -a v1.2.3 -m "发布版本 1.2.3"
git push origin v1.2.3

# 合并回develop分支
git checkout develop
git merge main
git push origin develop

# 删除release分支
git branch -d release/v1.2.3
git push origin --delete release/v1.2.3
```

#### 自动发布

推送到main分支会自动：
1. 构建release版本APK
2. 创建GitHub Release
3. 上传APK文件到Release

## 📱 APK分发

### 1. GitHub Releases

- **优点**: 免费、版本管理方便
- **适用**: 内测、小规模分发
- **下载**: 直接从GitHub下载

### 2. 应用商店发布

#### Google Play Store

1. **准备工作**:
   - 注册Google Play开发者账户
   - 准备应用图标、截图、描述

2. **上传APK**:
   - 使用Google Play Console
   - 上传签名的release APK
   - 填写应用信息

3. **发布流程**:
   - 内测 → 公测 → 正式发布

#### 其他应用商店

- **华为应用市场**: AppGallery Connect
- **小米应用商店**: 小米开发者平台
- **OPPO软件商店**: OPPO开放平台
- **vivo应用商店**: vivo开发者平台

## 🔍 质量保证

### 1. 发布前检查清单

- [ ] 版本号已更新
- [ ] 变更日志已更新
- [ ] 所有测试通过
- [ ] 代码分析无错误
- [ ] APK文件正常生成
- [ ] 应用在真机上正常运行
- [ ] 关键功能测试通过
- [ ] 性能测试通过

### 2. 测试设备覆盖

| 设备类型 | 测试重点 | 建议设备 |
|---------|---------|---------|
| 高端设备 | 功能完整性 | 旗舰Android手机 |
| 中端设备 | 性能表现 | 主流Android手机 |
| 低端设备 | 兼容性 | 入门级Android手机 |
| 平板设备 | 界面适配 | Android平板 |

### 3. 回归测试

每次发布前执行的核心功能测试：

1. **基础功能**
   - 应用启动和关闭
   - 页面导航
   - 数据输入和保存

2. **核心业务**
   - 记账功能
   - 统计查看
   - 数据导出

3. **集成功能**
   - 语音识别
   - 数据同步
   - 设置保存

## 📊 发布后监控

### 1. 关键指标

- **下载量**: GitHub Releases下载统计
- **崩溃率**: 通过日志收集监控
- **用户反馈**: GitHub Issues
- **性能指标**: 启动时间、内存使用

### 2. 问题响应

#### 紧急问题处理

```bash
# 创建热修复分支
git checkout -b hotfix/critical-bug main

# 修复问题后快速发布
git checkout main
git merge hotfix/critical-bug
git tag -a v1.2.4 -m "热修复版本 1.2.4"
git push origin main --tags
```

#### 用户反馈处理

1. **收集反馈**: GitHub Issues、应用商店评论
2. **问题分类**: Bug、功能请求、改进建议
3. **优先级排序**: 严重程度、影响范围
4. **版本规划**: 纳入下个版本开发计划

## 🔄 持续改进

### 1. 发布流程优化

- **自动化程度**: 逐步增加自动化环节
- **测试覆盖**: 提高自动化测试覆盖率
- **构建速度**: 优化构建和发布时间

### 2. 质量提升

- **代码审查**: 强制代码审查流程
- **静态分析**: 集成更多代码质量工具
- **性能监控**: 添加性能监控和报警

### 3. 用户体验

- **A/B测试**: 新功能灰度发布
- **用户调研**: 定期收集用户反馈
- **数据分析**: 基于使用数据优化功能

---

## 📅 发布时间表示例

| 版本 | 计划时间 | 主要功能 | 状态 |
|------|---------|---------|------|
| v1.0.0 | 2024-01-01 | 基础记账功能 | ✅ 已发布 |
| v1.1.0 | 2024-02-01 | 统计图表 | ✅ 已发布 |
| v1.2.0 | 2024-03-01 | 语音记账 | 🚧 开发中 |
| v1.3.0 | 2024-04-01 | 数据同步 | 📋 计划中 |

---

🎯 **目标**: 建立稳定、高效的版本发布流程，确保每个版本都能为用户提供优质的体验！