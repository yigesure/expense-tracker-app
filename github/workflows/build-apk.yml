name: Build Flutter APK

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Java
      uses: actions/setup-java@v3
      with:
        distribution: 'zulu'
        java-version: '17'
    
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.29.2'
        channel: 'stable'
    
    - name: Get dependencies
      run: flutter pub get
    
    - name: Build APK
      run: flutter build apk --debug
    
    - name: Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: expense-tracker-apk
        path: build/app/outputs/flutter-apk/app-debug.apk
        
    - name: Create Release
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.${{ github.run_number }}
        name: ä¸ªäººè®°è´¦åŠ©æ‰‹ v1.0.${{ github.run_number }}
        body: |
          ## ğŸ“± ä¸ªäººè®°è´¦åŠ©æ‰‹ APK
          
          ### åŠŸèƒ½ç‰¹è‰²
          - ğŸ  Dashboardé¦–é¡µ - è´¦æˆ·ä½™é¢ã€å¿«æ·æ“ä½œ
          - ğŸ“Š Statisticsç»Ÿè®¡ - å›¾è¡¨åˆ†æã€è¶‹åŠ¿ç»Ÿè®¡  
          - ğŸ¤– AIæ™ºèƒ½åŠ©æ‰‹ - è‡ªç„¶è¯­è¨€è®°è´¦
          - ğŸ“… Calendaræ—¥å† - æœˆå†è§†å›¾ã€æ¶ˆè´¹è¯¦æƒ…
          - âš™ï¸ Settingsè®¾ç½® - ä¸ªæ€§åŒ–é…ç½®
          
          ### å®‰è£…è¯´æ˜
          1. ä¸‹è½½ä¸‹æ–¹çš„APKæ–‡ä»¶
          2. åœ¨æ‰‹æœºä¸Šå…è®¸"æœªçŸ¥æ¥æº"åº”ç”¨å®‰è£…
          3. ç‚¹å‡»APKæ–‡ä»¶è¿›è¡Œå®‰è£…
          4. äº«å—ç°ä»£åŒ–çš„è®°è´¦ä½“éªŒï¼
          
        files: build/app/outputs/flutter-apk/app-debug.apk
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}